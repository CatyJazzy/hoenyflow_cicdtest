name: Frontend PR Check

on:
  pull_request:
    branches: [ main ]
    paths:
      - 'packages/frontend/**'
      - 'packages/shared/**'

jobs:
  build-check:
    if: contains(github.head_ref, 'dev-fe')
    runs-on: ubuntu-latest
    
    # Checks API ê¶Œí•œ
    permissions:
      checks: write
      
    steps:
      - uses: actions/checkout@v3
      
      - uses: pnpm/action-setup@v2
        with:
          version: 9.4.0
      
      - uses: actions/setup-node@v3
        with:
          node-version: '22.9.0'
          cache: 'pnpm'
      
      - name: Install dependencies
        run: pnpm install
      
      - name: Build frontend
        id: build
        working-directory: packages/frontend
        run: pnpm build
        continue-on-error: true

      - name: Process Build Result
        uses: actions/github-script@v6
        with:
          script: |
            const buildOutcome = '${{ steps.build.outcome }}';
            const [owner, repo] = context.repo.full_name.split('/'); // ownerì™€ repo ì •ë³´ë¥¼ ìë™ìœ¼ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤.
            
            await github.rest.checks.create({
              owner,
              repo,
              name: 'Frontend Build',
              head_sha: context.sha,
              status: 'completed',
              conclusion: buildOutcome === 'success' ? 'success' : 'failure',
              output: {
                title: buildOutcome === 'success' 
                  ? 'ğŸ‰ Frontend Build Successful' 
                  : 'âŒ Frontend Build Failed',
                
                summary: buildOutcome === 'success'
                  ? [
                      '## âœ… Build Status: Success',
                      '',
                      '### Build Information:',
                      '- **Build Time**: ' + new Date().toISOString(),
                      '- **Branch**: ' + context.ref,
                      '',
                      'âœ¨ Ready to be reviewed!'
                    ].join('\n')
                  : [
                      '## âŒ Build Status: Failed',
                      '',
                      '### Error Information:',
                      '- **Build Time**: ' + new Date().toISOString(),
                      '- **Branch**: ' + context.ref,
                      '',
                      '### Next Steps:',
                      '1. Check the build logs for detailed error messages',
                      '2. Fix the identified issues',
                      '3. Push your changes to trigger a new build',
                      '',
                      '> Need help? Contact the frontend team.'
                    ].join('\n'),
                
                text: buildOutcome === 'success'
                  ? 'ìì„¸í•œ ë¹Œë“œ ë¡œê·¸ëŠ” Actions íƒ­ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
                  : 'ë¹Œë“œ ì‹¤íŒ¨ ì›ì¸ì„ í™•ì¸í•˜ì‹œë ¤ë©´ ìœ„ì˜ "Details"ë¥¼ í´ë¦­í•˜ì„¸ìš”.'
              }
            });
            if (buildOutcome === 'failure') {
              core.setFailed('Frontend build failed');
            }
